var D=Object.defineProperty;var y=(r,t,e)=>t in r?D(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e;var o=(r,t,e)=>y(r,typeof t!="symbol"?t+"":t,e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const n of s)if(n.type==="childList")for(const a of n.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&i(a)}).observe(document,{childList:!0,subtree:!0});function e(s){const n={};return s.integrity&&(n.integrity=s.integrity),s.referrerPolicy&&(n.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?n.credentials="include":s.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function i(s){if(s.ep)return;s.ep=!0;const n=e(s);fetch(s.href,n)}})();class l{constructor({tag:t="div",className:e="",text:i=""},s){o(this,"node");o(this,"children",[]);o(this,"disabled",!1);const n=document.createElement(t);n.className=e,n.textContent=i,this.node=n,s&&this.appendChildren(s)}createElement(t){const e=document.createElement(t);this.node=e}appendChildren(t){t.forEach(e=>{this.append(e)})}append(t){this.children.push(t),this.node.append(t.getNode())}getNode(){return this.node}getChildren(){return this.children}setTextContent(t){this.node.textContent=t}setAttribute(t,e){this.node.setAttribute(t,e)}removeAttribute(t){this.node.removeAttribute(t)}toggleClass(t){this.node.classList.toggle(t)}addClass(t){this.node.classList.add(t)}removeClass(t){this.node.classList.contains(t)&&this.node.classList.remove(t)}setDisabled(t){this.disabled=t}getDisabled(){return this.disabled}addListener(t,e,i){this.node.addEventListener(t,e,i)}removeListener(t,e,i){this.node.removeEventListener(t,e,i)}removeChildren(){this.children.forEach(t=>{t.remove()}),this.children.length=0}remove(){this.removeChildren(),this.node.remove()}}class p extends l{constructor({url:t,className:e,text:i,preventedCallback:s}){super({tag:"a",className:e,text:i}),this.setAttribute("href",t),this.addListener("click",n=>{n==null||n.preventDefault(),!(s&&s(n))&&(this.getDisabled()||q.navigate(`/${t}`))})}}class N extends l{constructor(){super({className:"error-page"},[new l({tag:"h1",text:"Page not found"}),new p({text:"Back to main page",url:"",className:"long-link"})])}}class m extends l{constructor(t){super({tag:"button",className:t.className,text:t.text}),t.callback&&this.addListener("click",e=>t.callback(e))}setDisabled(t){super.setDisabled(t),this.getNode().disabled=this.getDisabled()}}class g extends l{constructor(t){super({tag:"input",className:"input"}),this.setInputProperties(t)}setDisabled(t){super.setDisabled(t),this.getNode().disabled=this.getDisabled()}setInputProperties({type:t,placeholder:e,id:i,validators:s,value:n="",name:a,callback:c}){const d=this.getNode();d.type=t,d.placeholder=e??"",d.value=n,a&&(d.name=a),i&&(d.id=i),c&&this.addListener("input",h=>c(h)),s==null||s.forEach(h=>this.setAttribute(h.name,h.value))}}class v extends l{constructor(t,e){super({tag:"label",text:t}),this.setAttribute("for",e)}}class k extends l{constructor(e){super({tag:"ul",className:"item-list"});o(this,"decisionList",[]);this.decisionService=e,this.renderDecisionList()}rerenderDecisionList(){this.removeChildren(),this.renderDecisionList()}saveDecisionList(){this.decisionService.saveListToLocalStorage()}renderDecisionList(){this.decisionList=this.decisionService.getDecisionList(),this.appendChildren(this.decisionList.map(e=>new I(e,this.decisionService)))}}class I extends l{constructor(e,i){super({tag:"li",className:"item"});o(this,"item");this.decisionService=i,this.item=e;const s=new v(e.id,e.id),n=new g({id:e.id,type:"text",placeholder:"Title",value:e.title,callback:this.updateTitle.bind(this)}),a=new g({type:"number",placeholder:"Weight",value:e.weight,callback:this.updateWeight.bind(this)}),c=new m({className:"delete-btn",text:"Delete",callback:this.removeItem.bind(this)});this.appendChildren([s,n,a,c])}removeItem(){this.decisionService.deleteItemById(this.item.id),this.remove()}updateTitle(e){this.decisionService.updateDecisionItemTitle(this.item.id,e.target.value)}updateWeight(e){this.decisionService.updateDecisionItemWeight(this.item.id,e.target.value)}}class L extends l{constructor({showOkBtn:e,textOkButton:i="Confirm",showCancelBtn:s,textCancelButton:n="Cancel",content:a}){super({tag:"dialog",className:"dialog"});o(this,"contentCotainer");o(this,"resolve");o(this,"reject");o(this,"okBtn");o(this,"cancelBtn");o(this,"actionContainer");this.contentCotainer=new l({className:"dialog-content"},a),this.actionContainer=new l({tag:"div",className:"dialog-actions"}),e&&(this.okBtn=new m({text:i,callback:this.okBtnCallback.bind(this)}),this.actionContainer.append(this.okBtn)),s&&(this.cancelBtn=new m({text:n,callback:this.cancelBtnCallback.bind(this)}),this.actionContainer.append(this.cancelBtn)),this.appendChildren([this.contentCotainer,this.actionContainer])}showModal(){return this.getNode().showModal(),new Promise((e,i)=>{this.resolve=e,this.reject=i})}closeModal(e){this.getNode().close(),e?this.resolve(e):this.reject(e),this.resolve=void 0,this.reject=void 0}okBtnCallback(){this.closeModal(!0)}cancelBtnCallback(){this.closeModal(!1)}}class x extends L{constructor(e){super({showOkBtn:!0,showCancelBtn:!0});o(this,"textarea");o(this,"placeholder",`
  Paste a list of new options in a CSV-like format:

  title,1                 -> | title                 | 1 |
  title with whitespace,2 -> | title with whitespace | 2 |
  title , with , commas,3 -> | title , with , commas | 3 |
  title with "quotes",4   -> | title with "quotes"   | 4 |
  `);this.decisionService=e,this.textarea=new l({tag:"textarea"}),this.textarea.setAttribute("placeholder",this.placeholder),this.textarea.setAttribute("rows","10"),this.contentCotainer.append(this.textarea)}showModal(){return this.textarea.getNode().value="",super.showModal()}okBtnCallback(){this.decisionService.setDecisionListFromString(this.textarea.getNode().value),super.okBtnCallback()}}class T extends l{constructor(e){super({tag:"main",className:"homepage"});o(this,"decisionListComponent");o(this,"goToStartPageLink");o(this,"validationDialog");o(this,"pasteDialog");this.decisionService=e,this.decisionListComponent=new k(this.decisionService),this.goToStartPageLink=new p({className:"long-link",text:"Start",url:"start",preventedCallback:this.goToStartPage.bind(this)}),this.validationDialog=new L({showCancelBtn:!0,textCancelButton:"Close",content:[new l({tag:"p",text:"Please add at least 2 valid options. An option is considered valid if its title is not empty and its weight is greater than 0"})]}),this.pasteDialog=new x(this.decisionService),this.appendChildren([new l({tag:"h1",className:"title",text:"Decision Making Tool"}),this.decisionListComponent,new m({className:"long-btn",text:"Add Option",callback:this.addOption.bind(this)}),new m({className:"long-btn",text:"Paste list",callback:this.pasteList.bind(this)}),new m({className:"long-btn",text:"Clear list",callback:this.clearList.bind(this)}),new m({className:"long-btn",text:"Save list to file",callback:this.saveList.bind(this)}),new m({className:"long-btn",text:"Load list from file",callback:this.loadList.bind(this)}),this.goToStartPageLink,this.validationDialog,this.pasteDialog]),window.addEventListener("beforeunload",()=>this.decisionService.saveListToLocalStorage())}remove(){this.decisionService.saveListToLocalStorage(),super.remove()}addOption(){this.decisionService.addDecision(),this.decisionListComponent.rerenderDecisionList()}pasteList(){this.pasteDialog.showModal().then(()=>this.decisionListComponent.rerenderDecisionList()).catch(()=>console.log("paste modal is closed"))}clearList(){this.decisionService.clearList(),this.decisionListComponent.rerenderDecisionList()}saveList(){this.decisionService.saveListToFile()}async loadList(){await this.decisionService.loadListFromFile(),this.decisionListComponent.rerenderDecisionList()}goToStartPage(){if(this.decisionService.getValidatedDecisionList().length<2)return this.validationDialog.showModal(),!0}}class P extends l{constructor(){super({tag:"form",className:"form"});o(this,"timeInput");o(this,"sound",!0);this.timeInput=new g({type:"number",id:"seconds",name:"time",value:"5",validators:[{name:"required",value:"true"},{name:"min",value:"5"}]}),this.timeInput.addListener("input",this.setValidity.bind(this));const e=[new p({className:"short-btn",text:"Back",url:""}),new m({className:"short-btn",text:"Sound",callback:this.toggleSound.bind(this)}),new v("Time","seconds"),this.timeInput,new m({className:"middle-btn",text:"Play"})];this.appendChildren(e)}submitForm(e){e.preventDefault();const i=this.timeInput.getNode();return i.validity.valueMissing?i.setCustomValidity("This field is required."):i.validity.rangeUnderflow&&i.setCustomValidity("The number must be at least 5."),i.reportValidity(),{value:i.value,sound:this.sound,isValid:this.getNode().checkValidity()}}setDisabled(e){super.setDisabled(e),this.getChildren().forEach(i=>i.setDisabled(this.getDisabled())),this.getDisabled()?this.addClass("disabled"):this.removeClass("disabled")}setValidity(e){(e==null?void 0:e.target).setCustomValidity("")}toggleSound(e){this.sound=!this.sound,e.target.classList.toggle("active")}}class A extends l{constructor(e){super({tag:"canvas",className:"diagramm"});o(this,"animationFrame");o(this,"duration");o(this,"currentAngle",0);o(this,"cancelAnimation",!1);o(this,"decisionList");o(this,"colors");o(this,"startTime");o(this,"speed",1);o(this,"minSpeed",.5);o(this,"deceleration");this.decisionService=e,this.decisionList=this.shuffleArray(this.decisionService.getValidatedDecisionList()),this.colors=this.generateRandomColors(),this.setAttribute("width","500"),this.setAttribute("height","500"),this.drawDiagramm()}async spinWheel(e){return this.duration=e,this.startTime=performance.now(),new Promise((i,s)=>{this.animationFrame=requestAnimationFrame(this.animate.bind(this,i,s))})}remove(){this.cancelAnimation=!0,super.remove()}drawDiagramm(){const e=this.getNode(),i=e.getContext("2d");if(!i)return;i.clearRect(0,0,e.width,e.height);const s=this.decisionList.reduce((a,c)=>a+Number(c.weight),0);let n=this.currentAngle%(2*Math.PI);this.decisionList.forEach((a,c)=>{const d=Number(a.weight)/s*2*Math.PI;let h=n+d;h=h%(2*Math.PI),i.beginPath(),i.moveTo(e.width/2,e.height/2),i.arc(e.width/2,e.height/2,e.width/2,n,h),i.closePath(),i.fillStyle=this.colors[c%this.colors.length],i.fill(),i.strokeStyle="#fff",i.lineWidth=2,d>=.3&&this.drawSegmentText(i,e,a.title,n,h),i.stroke(),n=h}),this.drawPointer(i,e),this.drawCenterCircle(i,e)}drawPointer(e,i){const s=i.width/2,n=5,a=15;e.beginPath(),e.moveTo(s-a,n),e.lineTo(s+a,n),e.lineTo(s,n+a),e.closePath(),e.fillStyle="red",e.fill(),e.lineWidth=3,e.strokeStyle="black",e.stroke()}drawCenterCircle(e,i){const s=i.width/2,n=i.height/2,a=20;e.beginPath(),e.arc(s,n,a,0,2*Math.PI),e.fillStyle="white",e.fill(),e.strokeStyle="black",e.lineWidth=2,e.stroke()}animate(e,i,s){if(this.cancelAnimation&&i("remove"),!this.getNode().getContext("2d"))return;if(this.deceleration=this.speed/(this.duration/16),s-this.startTime>=this.duration){cancelAnimationFrame(this.animationFrame);const d=this.selectWinner();d==="error"?i("error"):e(d);return}this.speed=Math.max(this.speed-this.deceleration,this.minSpeed),this.currentAngle+=this.speed*(Math.PI/180),this.currentAngle%=2*Math.PI,this.drawDiagramm(),this.animationFrame=requestAnimationFrame(this.animate.bind(this,e,i))}selectWinner(){const e=this.decisionList.reduce((n,a)=>n+Number(a.weight),0),i=Math.PI/2*3;let s=this.currentAngle%(2*Math.PI);for(const n of this.decisionList){const a=Number(n.weight)/e*2*Math.PI;let c=s+a;if(c=c%(2*Math.PI),i>=s&&i<c)return n.title;s=c}return"error"}generateRandomColors(){return Array.from({length:this.decisionList.length},()=>`#${Math.floor(Math.random()*16777215).toString(16).padStart(6,"0")}`)}shuffleArray(e){return[...e].sort(()=>Math.random()-.5)}drawSegmentText(e,i,s,n,a){const d=i.width/2,h=i.height/2,f=i.width/3;n>a&&(a+=2*Math.PI);const u=(n+a)/2,b=u>Math.PI?Math.PI:0,S=d+f*Math.cos(u),C=h+f*Math.sin(u);e.save(),e.translate(S,C),e.rotate(u+b),e.fillStyle="white",e.font="16px Arial",e.textAlign="center",e.textBaseline="middle",s.length>=13&&(s=`${s.substring(0,13)}...`),e.lineWidth=4,e.strokeStyle="black",e.strokeText(s,0,0),e.fillText(s,0,0),e.restore()}}const M="/decision-making-tool/assets/zvuk-tadam-i-aplodismenty-BSCrQAem.mp3";class F extends l{constructor(e){super({tag:"main",className:"startpage"});o(this,"diagrammComponent");o(this,"decisionForm");o(this,"winnerNameComponent");o(this,"defaultWinnerText","The winner is: ");this.decisionService=e,this.diagrammComponent=new A(this.decisionService),this.decisionForm=new P,this.decisionForm.addListener("submit",i=>this.chooseDecision(i)),this.winnerNameComponent=new l({tag:"p",className:"winner-name",text:this.defaultWinnerText}),this.appendChildren([new l({tag:"h1",className:"title",text:"Decision Making Tool"}),this.decisionForm,this.winnerNameComponent,new l({tag:"h2",className:"h2",text:"Press Start Button"}),new l({className:"canvas-wrapper"},[this.diagrammComponent])])}async chooseDecision(e){const{value:i,isValid:s,sound:n}=this.decisionForm.submitForm(e);if(this.winnerNameComponent.setTextContent(this.defaultWinnerText),s){this.decisionForm.setDisabled(!0);try{const a=await this.diagrammComponent.spinWheel(Number(i)*1e3);this.decisionForm.setDisabled(!1),n&&this.playMusic(),this.winnerNameComponent.setTextContent(this.defaultWinnerText+a)}catch(a){console.log(a)}}}playMusic(){const e=new Audio(M);e.addEventListener("canplaythrough",()=>{e.play().then(()=>e.remove())})}}class B{constructor(t,e){o(this,"routes");o(this,"appRoot");o(this,"currentComponent",null);this.routes=t,this.appRoot=e,this.init()}navigate(t){this.routes[t]?(history.pushState(null,"",t),this.renderRoute()):this.navigate("/404")}init(){window.addEventListener("popstate",()=>this.renderRoute()),document.addEventListener("DOMContentLoaded",()=>this.renderRoute())}renderRoute(){const t=window.location.pathname,e=this.routes[t]||this.routes["/404"];e&&(this.currentComponent&&this.currentComponent.remove(),this.currentComponent=e(),this.appRoot.appendChild(this.currentComponent.getNode()))}}class E{constructor(){o(this,"prefix","[er-decision-making-tool]")}setItem(t,e){const i=JSON.stringify(e);localStorage.setItem(`${this.prefix} ${t}`,i)}getItem(t){const e=localStorage.getItem(`${this.prefix} ${t}`);return e?JSON.parse(e):void 0}removeItem(t){localStorage.removeItem(`${this.prefix} ${t}`)}}const W=new E;class R{saveFile(t){const e=new Blob([JSON.stringify(t,null,2)],{type:"application/json"}),i=document.createElement("a");i.href=URL.createObjectURL(e),i.download="option-list",document.body.appendChild(i),i.click(),document.body.removeChild(i)}loadFile(){const t=document.createElement("input");return t.type="file",t.accept="application/json",new Promise((e,i)=>{t.addEventListener("change",async()=>{var a;const s=(a=t.files)==null?void 0:a[0];if(!s){i(new Error("No file"));return}const n=new FileReader;n.onload=async c=>{var d;try{const h=JSON.parse((d=c.target)==null?void 0:d.result);e(h)}catch(h){i(new Error("Error JSON: "+h))}},n.readAsText(s)}),t.click()})}}const O=new R;class V{constructor(t,e){o(this,"decisionList",[]);o(this,"lastId",0);o(this,"localStorageKey","decision-list");this.localStorageService=t,this.fileSystemService=e,this.loadListFromLocalStorage()}getDecisionList(){return this.decisionList}addDecision(){this.decisionList.push({id:this.generateNewId(),title:"",weight:""})}updateDecisionItemTitle(t,e){this.decisionList.find(i=>i.id===t).title=e}updateDecisionItemWeight(t,e){this.decisionList.find(i=>i.id===t).weight=e}clearList(){this.decisionList.length=0}deleteItemById(t){this.decisionList=[...this.decisionList].filter(e=>e.id!==t)}saveListToFile(){this.fileSystemService.saveFile(this.generateDataToSave())}async loadListFromFile(){const t=await this.fileSystemService.loadFile();this.decisionList=t.list,this.lastId=t.lastId}saveListToLocalStorage(){this.localStorageService.setItem(this.localStorageKey,this.generateDataToSave())}loadListFromLocalStorage(){const t=this.localStorageService.getItem(this.localStorageKey)??{lastId:1,list:[{id:"#1",title:"",weight:""}]};this.decisionList=this.checkDecisionList(t.list),this.lastId=t.lastId}getValidatedDecisionList(){return this.decisionList.filter(this.strictValidateDecision.bind(this))}setDecisionListFromString(t){const e=t.split(/\r?\n/).reduce((i,s)=>{const n=s.split(","),a=String(n.pop()).trim(),c=n.join("").trim();if(this.checkWeight(a)&&this.checkTitle(c)){const d={id:this.generateNewId(),title:c,weight:a};i.push(d)}return i},[]);this.decisionList=[...this.decisionList,...e]}generateNewId(){if(this.decisionList.length===0)return this.lastId=1,"#1";const t=this.lastId+1;return this.lastId=t,`#${t}`}strictValidateDecision(t){return this.checkId(t.id)&&this.checkTitle(t.title)&&this.checkWeight(t.weight)}softValidateDecision(t){return this.checkId(t.id)}generateDataToSave(){return{lastId:this.lastId,list:this.decisionList}}checkDecisionList(t){return t.filter(this.softValidateDecision.bind(this)).sort((e,i)=>e.id.localeCompare(i.id))}checkId(t){return/^#([1-9]\d*)$/.test(t)}checkWeight(t){return/^[1-9]\d*$/.test(t)||t===void 0}checkTitle(t){return t.trim()!==""}}const w=new V(W,O),$={"/":()=>new T(w),"/start":()=>new F(w),"/404":()=>new N},q=new B($,document.body);
